/* Aug 28, 2014 at 2:01 PM */

!function(a){XenForo.SpriteCow=function(a){this.__construct(a)},XenForo.SpriteCow.prototype={__construct:function(){XenForo.SmileySpriteCow.init()}},XenForo.SmileySpriteCow={init:function(){var b=a(".canvas-inner"),c=a(".code-container"),d=a("#ImageUrl"),e=new spriteCow.SpriteCanvas,f=new spriteCow.SpriteCanvasView(e,b),g=new spriteCow.ImgInput(b,b,d.val()),h=new spriteCow.CssOutput(c),i=new spriteCow.Toolbar(".toolbar-container"),j=new spriteCow.Toolbar(".toolbar-bottom-container"),k=a("#lockHeight").appendTo("body").hide(),l=a("#lockWidth").appendTo("body").hide();i.addItem("add-smiley",XenForo.phrases.add_smiley).addItem((new spriteCow.ToolbarGroup).addItem("select-sprite",XenForo.phrases.select_sprite,{active:!0}).addItem("select-bg",XenForo.phrases.pick_background)).addItem("invert-bg",XenForo.phrases.toggle_dark_background,{noLabel:!0}),j.addItem("auto-resize","Auto resize",{active:!0,noLabel:!0}).addItem("lock-height","Lock-on height",{noLabel:!0}).addItem("lock-width","Lock-on width",{noLabel:!0}),i.$container.addClass("top"),j.$container.addClass("bottom"),spriteCow.pageLayout.init(),localStorage.setItem("autoResize","on"),localStorage.setItem("lockHeight",0),localStorage.setItem("lockWidth",0),g.bind("load",function(a){e.setImg(a),h.imgWidth=e.canvas.width,h.imgHeight=e.canvas.height,h.scaledWidth=Math.round(h.imgWidth/2),h.scaledHeight=Math.round(h.imgHeight/2),f.setTool("select-sprite"),h.backgroundFileName=g.fileName,spriteCow.pageLayout.toAppView()}),f.bind("rectChange",function(a){h.rect=a,h.update(),a.width===e.canvas.width&&a.height===e.canvas.height&&i.feedback(XenForo.phrases.incorrect_background,!0)}),f.bind("bgColorHover",function(a){i.feedback(XenForo.SmileySpriteCow.colourBytesToCss(a))}),f.bind("bgColorSelect",function(a){var b="select-sprite";f.setTool(b),i.activate(b),i.feedback(XenForo.phrases.background_set_to_x.replace(/\{color\}/,XenForo.SmileySpriteCow.colourBytesToCss(a)))}),i.bind("add-smiley",function(b){if(a.isEmptyObject(h.output))i.feedback(XenForo.phrases.select_sprite_first,!0);else{var c=a.extend(h.output,{sprite_image:d.val(),"new":a("input[name=new]").val(),title:a("input[name=title]").val(),display_order:a("input[name=display_order]").val(),smilie_category_id:a("input[name=smilie_category_id]").val()});new spriteCow.XenForoSmiley(c)}b.preventDefault()}),i.bind("select-bg",function(){f.setTool("select-bg")}),i.bind("select-sprite",function(){f.setTool("select-sprite")}),i.bind("invert-bg",function(a){f.setBg(a.isActive?"#fff":"#000")}),j.bind("auto-resize",function(a){a.isActive?localStorage.setItem("autoResize","off"):localStorage.setItem("autoResize","on")}),j.bind("lock-height",function(a){a.isActive?(XenForo.SmileySpriteCow.updateInput("lockHeight",k.val()),k.appendTo("body").hide()):k.insertBefore(j._$feedback).show()}),j.bind("lock-width",function(a){a.isActive?(XenForo.SmileySpriteCow.updateInput("lockWidth",l.val()),l.appendTo("body").hide()):l.insertBefore(j._$feedback).show()}),g.loadImgUrl(d.val())},updateInput:function(b,c){val=a.isNumeric(c)?parseInt(c):0,localStorage.setItem(b,val)},colourBytesToCss:function(a){return 0===a[3]?"transparent":"rgba("+a[0]+", "+a[1]+", "+a[2]+", "+String(a[3]/255).slice(0,5)+")"},add:function(b){XenForo.ajax("admin.php?smilies/sprite",b,function(b){return XenForo.hasResponseError(b)?!1:void(b.templateHtml&&a(b.templateHtml).xfInsert("appendTo",".SmileyList","xfFadeIn",XenForo.speed.slow))})}},XenForo.register(".SpriteCow","XenForo.SpriteCow")}(jQuery,this,document);